FROM php:7.2.6-fpm-alpine3.7

#RUN apt-get update && apt-get install -y \
#        git zlib1g-dev && \
#        docker-php-ext-install zip

WORKDIR /app

# install composer
RUN php -r "readfile('http://getcomposer.org/installer');" | php -- --install-dir=/usr/bin/ --filename=composer

# copy php.ini config
COPY misc/config/php.ini /usr/local/etc/php/

# composer
RUN composer global require hirak/prestissimo
COPY composer.json /app/
COPY composer.lock /app/
RUN  composer install --prefer-dist --no-interaction --no-scripts -o
RUN  composer dump-autoload --optimize

ADD app /app/app
ADD bin /app/bin
ADD web /app/web
ADD src /app/src

RUN  composer run-script post-install-cmd --no-interaction
RUN  composer dump-autoload --optimize
