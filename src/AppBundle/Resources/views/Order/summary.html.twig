{% extends 'AppBundle:Layouts:base-template.html.twig' %}

{% block htmlTitle %}{{ ('order.' ~ order.type) | trans }} summary{% endblock %}
{% block pageTitle %}
    <span class="govuk-caption-l">{{ order.client.caseNumber }} {{ order.client.clientName }}</span>
    <h1 class="govuk-heading-l">{{ ('order.' ~ order.type) | trans }} summary</h1>
{% endblock %}

{% block content %}
    <h2 class="govuk-heading-m">Order details</h2>

    <table class="govuk-table">
        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">Question</th>
                <th scope="col" class="govuk-table__header">Answer</th>
                <th scope="col" class="govuk-table__header"></th>
            </tr>
        </thead>
        <tbody class="govuk-table__body">

        {# assets question only for PA orders #}
        {% if order.type == constant('AppBundle\\Entity\\Order::TYPE_PA') %}
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">
                    Are the bond or assets above Â£21,000?
                </td>
                <td class="govuk-table__cell behat-region-has-assets">
                    {% if order.hasAssetsAboveThreshold %}
                        {{ ('order.hasAssets.' ~ order.hasAssetsAboveThreshold) | trans }}
                    {% endif %}
                </td>
                <td class="govuk-table__cell govuk-table__cell--numeric">
                    <a href="{{ path('order-edit', {'orderId': order.id}) }}" class="govuk-link govuk-!-font-weight-bold">Edit</a>
                </td>
            </tr>
        {% endif %}

        <tr class="govuk-table__row">
            <td class="govuk-table__cell">Order subtype</td>
            <td class="govuk-table__cell behat-region-order-subtype">
                {% if order.subType %}
                    {{ ('order.subType.' ~ order.subType) | trans }}
                {% endif %}
            </td>
            <td class="govuk-table__cell govuk-table__cell--numeric">
                <a href="{{ path('order-edit', {'orderId': order.id}) }}" class="govuk-link govuk-!-font-weight-bold">Edit</a>
            </td>
        </tr>

        <tr class="govuk-table__row">
            <td class="govuk-table__cell">
                Appointment type
            </td>
            <td class="govuk-table__cell behat-region-app-type">
                {% if order.appointmentType %}
                    {{ ('order.appointmentType.' ~ order.appointmentType) | trans }}
                {% endif %}
            </td>
            <td class="govuk-table__cell govuk-table__cell--numeric">
                <a href="{{ path('order-edit', {'orderId': order.id}) }}" class="govuk-link govuk-!-font-weight-bold">Edit</a>
            </td>
        </tr>

        </tbody>
    </table>


    {# ----- DEPUTIES ----- #}

    <h2 class="govuk-heading-m">Deputies</h2>

    {% if order.deputies | length %}
        {% for deputy in order.deputies %}
            <table class="govuk-table">
                <thead class="govuk-table__head">
                    <tr>
                        <th scope="col" class="govuk-table__header">Deputy {{ loop.index }}</th>
                        <th scope="col" class="govuk-table__header govuk-table__header--numeric">
                            <a href="#" class="govuk-!-margin-right-3">Edit</a>
                            <a href="#">Remove</a>
                        </th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell" scope="row">Name</td>
                            <td class="govuk-table__cell">{{ deputy.fullname }}</td>
                        </tr>
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell" scope="row">Email address</td>
                            <td class="govuk-table__cell">{{ deputy.emailAddress }}</td>
                        </tr>
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell" scope="row">Deputy type</td>
                            <td class="govuk-table__cell">{{ deputy.deputyType }}</td>
                        </tr>
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell" scope="row">Organisation</td>
                            <td class="govuk-table__cell">{{ deputy.organisationName }}</td>
                        </tr>
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell" scope="row">Address</td>
                            <td class="govuk-table__cell">{{ deputy.addressFormatted }}</td>
                        </tr>
                </tbody>
            </table>
        {% endfor %}
    {% else %}
        <p>Add the details of each deputy named on the order.</p>
    {% endif %}

    <p>
        <a href="{{ path('deputy-add', {'orderId': order.id}) }}" class="govuk-link govuk-!-font-weight-bold">
            <span class="govuk-icon govuk-icon--plus"></span>Add a deputy
        </a>
    </p>


    {# ----- DOCUMENTS ----- #}

    <h2 class="govuk-heading-m">Order documents</h2>
    <p>Attach the documents listed below and any other relevant documents.</p>

    <table class="govuk-table">
        <thead class="govuk-table__head">
            <tr>
                <th scope="col" class="govuk-table__header">Document</th>
                <th scope="col" class="govuk-table__header">Status</th>
                <th scope="col" class="govuk-table__header"></th>
            </tr>
        </thead>

        <tbody class="govuk-table__body">
        {% for docType in order.expectedDocuments %}
            {% set doc = order.getDocumentsByType(docType) | first %}

            <tr class="govuk-table__row">
                <td class="govuk-table__cell">{{ ('document.type.' ~ docType) | trans }}</td>
                <td class="govuk-table__cell">
                    {% if doc | length %}
                        Uploaded
                    {% else %}
                        Required
                    {% endif %}
                </td>
                <td class="govuk-table__cell govuk-table__cell--numeric">
                    <a href="{{
                        doc | length ?
                        path('document-remove', {'orderId': order.id, 'id': doc.id})
                        : path('document-add', {'orderId': order.id, 'docType': docType})
                    }}"
                       class="govuk-link govuk-!-font-weight-bold">
                        {% if doc | length %}
                            Remove
                        {% else %}
                            <span class="govuk-icon govuk-icon--plus"></span>Add document
                        {% endif %}
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <h3 class="govuk-heading-s">Other relevant documents</h3>

    {% set otherDocs = order.getDocumentsByType(constant('AppBundle\\Entity\\Document::TYPE_ADDITIONAL')) %}
    {% if otherDocs | length %}

        <table class="govuk-table">
            <thead class="govuk-table__head">
                <tr>
                    <th scope="col" class="govuk-table__header">File name</th>
                    <th scope="col" class="govuk-table__header">Date attached</th>
                    <th scope="col" class="govuk-table__header"></th>
                </tr>
            </thead>

            <tbody class="govuk-table__body behat-region-document-list">
            {% for doc in otherDocs %}
                <tr class="govuk-table__row">
                    <td class="govuk-table__cell">{{ doc.file }}</td>
                    <td class="govuk-table__cell"><span class="debug-highlight">29 March 2018 18:13</span></td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <a href="{{ path('document-remove', {'orderId': order.id, 'id': doc.id}) }}" class="behat-link-delete-documents-button govuk-link govuk-!-font-weight-bold">Remove</a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}



    <p class="govuk-!-margin-bottom-9">
        <a href="{{ path('document-add', {'orderId': order.id, 'docType': constant('AppBundle\\Entity\\Document::TYPE_ADDITIONAL') }) }}"
           class="govuk-link govuk-!-font-weight-bold">
           <span class="govuk-icon govuk-icon--plus"></span>Add additional document
       </a>
    </p>

    {% if order.readyToServe %}
        <a class="govuk-button" href="{{ path('order-declaration', {'orderId': order.id}) }}" >Continue</a>
    {% else %}
        <div class="govuk-alert govuk-alert--info">
            <span class="govuk-icon govuk-icon--info"></span>
            <div class="govuk-alert__message">
                <p>To continue, please add one or more deputies and upload all the required order documents.</p>
            </div>
        </div>
        <button class="govuk-button" disabled="disabled">Continue</button>
    {% endif %}

{% endblock %}